(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(e){if(e.ep)return;e.ep=!0;const r=i(e);fetch(e.href,r)}})();const t=require("three"),{OBJLoader:j}=require("three/examples/jsm/loaders/OBJLoader.js"),{extractVertexPositions:N,getLipIndices:O}=require("./utils.js"),{app:J,BrowserWindow:S,dialog:z,ipcMain:G}=require("electron"),F=require("path"),d=new t.Scene,b=new t.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),E=new t.WebGLRenderer;E.setSize(window.innerWidth,window.innerHeight);E.setClearColor(16777215);document.body.appendChild(E.domElement);b.position.z=2;b.fov=36;b.updateProjectionMatrix();const H=new t.DirectionalLight(16777215,2);H.position.set(1,1,1).normalize();d.add(H);function P(){requestAnimationFrame(P),E.render(d,b)}let B=null,w=[],f=!0,g,x,y,p=[];async function R(){const o=await ipcRenderer.invoke("open-directory-dialog");if(o&&o.length>0){const c=o[0];_(c)}}function _(o){const c=require("fs"),i=require("path");c.readdir(o,(n,e)=>{if(n){console.error("Error reading directory:",n);return}const r=e.filter(a=>i.extname(a).toLowerCase()===".obj"),s=document.getElementById("fileList");s.innerHTML="",r.forEach(a=>{const L=i.join(o,a),u=document.createElement("div");u.textContent=a,u.addEventListener("click",()=>{Array.from(s.children).forEach(m=>{m.classList.remove("selected")}),u.classList.add("selected"),$(L)}),s.appendChild(u)})})}function T(){w.forEach(o=>d.remove(o)),p.forEach(o=>d.remove(o)),w=[],p=[]}function $(o){console.log(o),B&&(d.remove(B),T()),G.handle("open-directory-dialog",async i=>{const n=S.getFocusedWindow(),e=await z.showOpenDialog(n,{properties:["openDirectory"]});return e.canceled?[]:e.filePaths});const c=new j;c.setPath(F.dirname(o)+"/"),c.load(F.basename(o),async i=>{d.add(i),B=i,i.traverse(n=>{n instanceof t.Mesh&&n.geometry.computeVertexNormals()}),P(),Promise.all([N(o),O("lip_index.txt"),O("lip_outline_index.txt")]).then(([n,e,r])=>{const s=new t.Vector3(1/0,1/0,1/0),a=new t.Vector3(-1/0,-1/0,-1/0);r.forEach(l=>{if(l>=0&&l<n.length){const h=n[l];s.min(h),a.max(h)}else console.error(`Vertex index ${l} is out of bounds`)}),e.forEach(l=>{if(l>=0&&l<n.length){const h=n[l],A=new t.SphereGeometry(.05,16,16),D=new t.MeshBasicMaterial({color:16711680}),v=new t.Mesh(A,D);v.position.copy(h),d.add(v),w.push(v)}else console.error(`Vertex index ${l} is out of bounds`)}),P();const L=new t.Box3(s,a);y=new t.Box3Helper(L,16765235);const u=new t.Vector3(.8,1,0),m=s.clone().sub(u),I=a.clone().add(u),W=new t.Box3(m,I);g=new t.Box3Helper(W,3407685);const M=new t.Vector3(.8,1,0),q=m.clone().sub(M),V=I.clone().add(M),C=new t.Box3(q,V);x=new t.Box3Helper(C,16724942),d.add(y),d.add(g),d.add(x),p.push(y),p.push(g),p.push(x)}).catch(n=>{console.error("An error occurred: ",n)})},i=>{console.log(i.loaded/i.total*100+"% loaded")},i=>{console.error("An error occurred",i)})}document.getElementById("selectDirectory").addEventListener("click",R);document.getElementById("toggleVertices").addEventListener("click",()=>{f=!f,w.forEach(o=>o.visible=f)});document.getElementById("toggleBoundingBox").addEventListener("click",()=>{f=!f,g.visible=f,x.visible=f,y.visible=f});
